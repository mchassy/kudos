export FLASK_APP=/prj/kudos/kudos_oss/app/http/api/endpoints.py
export APP_CONFIG_FILE=/prj/kudos/config/development.py
export FLASK_ENV=development
export LC_ALL=C.UTF-8
export LANG=C.UTF-8
export PATH="/home/ubuntu/.local/bin:$PATH"
echo "#######################################################"
if [[ $CI_JOB_STAGE != "" ]]
then
    cd /builds/mapu/kudos
    echo "Running $CI_JOB_STAGE on Gitlab runner"
else
    CI_JOB_STAGE="locally"
    cd /prj
    echo "Running $CI_JOB_STAGE"
fi
echo "from $PWD"
echo "#######################################################"
if [[ -d "./env/bin"  && $CI_JOB_STAGE == "locally" ]]
then
    echo "#######################################################"
    echo "Activating virtual environment"
    echo "#######################################################"
    source ./env/bin/activate
fi
if [[ $CI_JOB_STAGE == "locally" || $CI_JOB_STAGE == "lint_code" ]] && [[ ! -d "./env/bin" ]]
then
    echo "#######################################################"
    echo "Creating virtual environment"
    echo "#######################################################"
    python -m venv env
    echo "#######################################################"
    echo "Activating virtual environment"
    echo "#######################################################"
    source ./env/bin/activate
    pip install -r ./dev/requirements.txt
fi
if [[ $CI_JOB_STAGE == "build_image" ]]
then
  echo "#######################################################"
  echo "Installing awscli"
  echo "#######################################################"
  sudo apt-get install awscli
fi
