export FLASK_APP=/prj/kudos/kudos_oss/app/http/api/endpoints.py
export APP_CONFIG_FILE=/prj/kudos/config/development.py
export FLASK_ENV=development
export LC_ALL=C.UTF-8
export LANG=C.UTF-8
export PATH="/home/ubuntu/.local/bin:$PATH"
if [[ $CI_JOB_STAGE == "" ]]
then
    cd /prj
    echo "Running locally"
    if [[ ! -d "./env/bin" ]]
    then
        echo "#######################################################"
        echo "Creating virtual environment"
        echo "#######################################################"
        python -m venv env
        echo "#######################################################"
        echo "Activating virtual environment"
        echo "#######################################################"
        source ./env/bin/activate
        pip install -r ./dev/requirements.txt
    else
        echo "#######################################################"
        echo "Activating virtual environment"
        echo "#######################################################"
        source ./env/bin/activate
    fi
elif [[ $CI_JOB_STAGE == "lint_code" ]]
then
    cd /builds/mapu/kudos
    echo "Running $CI_JOB_STAGE"
    echo "#######################################################"
    echo "Creating virtual environment"
    echo "#######################################################"
    python -m venv env
    echo "#######################################################"
    echo "Activating virtual environment"
    echo "#######################################################"
    source ./env/bin/activate
    pip install -r ./dev/requirements.txt
elif [[ $CI_JOB_STAGE == "lint_config" ]]
then
    cd /builds/mapu/kudos
    echo "Running $CI_JOB_STAGE"
elif [[ $CI_JOB_STAGE == "build_image" ]]
then
    cd /builds/mapu/kudos
    echo "Running $CI_JOB_STAGE"
    sudo apt-get install awscli
elif [[ $CI_JOB_STAGE == "test_image" ]]
then
    cd /builds/mapu/kudos
    echo "Running $CI_JOB_STAGE"
else
    echo "Something has gone terrible wrong"
fi
